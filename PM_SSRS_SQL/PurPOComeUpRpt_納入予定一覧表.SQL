--PurPOComeUpRpt_納入予定一覧表SQL
DECLARE @PO_DUE_DATE_FROM INT,
        @PO_DUE_DATE INT,
        @SCH_ID VARCHAR(10),
        @BUYER_CD VARCHAR(10),
        @VENDOR_CD VARCHAR(10),
        @ITEM_NO VARCHAR(20),
        @CATG_CD VARCHAR(10),
        @JOC_CD VARCHAR(20),
        @WHS_CD VARCHAR(10)
SET @PO_DUE_DATE_FROM=0
SET @PO_DUE_DATE=0
SET @SCH_ID=''
SET @BUYER_CD=''
SET @VENDOR_CD=''
SET @ITEM_NO=''
SET @CATG_CD=''
SET @JOC_CD=''
SET @WHS_CD=''

SELECT
CASE PUR.PO_NO WHEN NULL THEN NULL WHEN '' THEN NULL 
ELSE PUR.PO_NO+RIGHT('000'+CONVERT(VARCHAR(3),PUR.PO_LINE_NO),3) END AS PO_NO     ,PUR.ITEM_NO ,
PUR.VENDOR_CD ,                  PUR.PO_QTY                      ,PUR.RECV_QTY    ,
PUR.ACCEPT_QTY,                  PUR.PO_UMSR                     ,PUR.PO_DUE_DATE ,
PUR.SCH_ID,                      PUR.BUYER_CD                    ,PUR.JOC_CD      ,
PUR.WHS_CD  ,                        I.CATG_CD                           ,V.VENDOR_NAME   ,
W.WHS_DESC ,                     PUR.ITEM_DESC,
S1.DATA_CHAR AS   UMSR_NAME ,    S2.DATA_CHAR AS SCH_NAME ,
PUR.ACCEPT_QTY,             PUR.REJ_QTY, (CASE WHEN (PUR.PO_QTY-PUR.RECV_QTY+PUR.REJ_QTY) <0
 THEN 0 ELSE (PUR.PO_QTY-PUR.RECV_QTY+PUR.REJ_QTY) END) RESIDUEQTY,
S3.DATA_CHAR AS   BUYER_NAME
FROM PUR_ORDER PUR
LEFT JOIN ITEM_MASTER I ON PUR.ITEM_NO=I.ITEM_NO
LEFT JOIN VENDOR_MASTER V ON PUR.VENDOR_CD = V.VENDOR_CD
LEFT JOIN WAREHOUSE_MASTER W ON PUR.WHS_CD=W.WHS_CD
LEFT JOIN SYSTEM_PARAMETER  S1 ON   PUR.PO_UMSR = S1.KEY02  AND  S1.KEY01='ITEM_UMSR'
LEFT JOIN SYSTEM_PARAMETER  S2 ON   PUR.SCH_ID = S2.KEY02   AND  S2.KEY01='SCH_ID'
LEFT JOIN SYSTEM_PARAMETER  S3 ON   PUR.BUYER_CD =S3.KEY02  AND  S3.KEY01='BUYER_CD'
WHERE 1 = 1
  AND PUR.ORDER_STATUS >= 10
  AND PUR.ORDER_STATUS <75 
  AND (PUR.PO_DUE_DATE   >= @PO_DUE_DATE_FROM or @PO_DUE_DATE_FROM = 0) 
  AND (PUR.PO_DUE_DATE   <= @PO_DUE_DATE or @PO_DUE_DATE = 0) 
  AND (PUR.SCH_ID = @SCH_ID or @SCH_ID = '')
  AND (PUR.BUYER_CD = @BUYER_CD or @BUYER_CD = '')
  AND (PUR.VENDOR_CD = @VENDOR_CD or @VENDOR_CD = '')
  AND (PUR.ITEM_NO LIKE @ITEM_NO or @ITEM_NO = '')
  AND (I.CATG_CD = @CATG_CD or @CATG_CD = '')
  AND (PUR.JOC_CD = @JOC_CD or @JOC_CD = '')
  AND (PUR.WHS_CD = @WHS_CD or @WHS_CD = '')
ORDER BY PUR.BUYER_CD, PUR.PO_DUE_DATE, PUR.PO_NO

