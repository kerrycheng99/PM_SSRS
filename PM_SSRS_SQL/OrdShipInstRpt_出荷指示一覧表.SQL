--出荷指示一覧表SQL (OrdShipInstRpt)
SELECT 
SS.SCH_SHIP_DATE,    SOD.SHIP_WHS,              WHS.WHS_DESC,       SS.SHIP_NO, 
SO.SHIP_TO_CD+'-'+SO.SHIP_TO_SUB_CD SHIP_TO_NO, CM.CUST_NAME,       SO.ADDRESS1, 
SOD.ITEM_NO,         I.ITEM_DESC,               SS.SCH_SHIP_QTY,    I.ITEM_UMSR, 
SS.ORDER_NO+'-'+CONVERT(varchar,SS.ORDER_LINE_NO) ORDER_NO,    SA.LOCATION, SA.LOT_NO, SA.JOC_CD,
SA.ALLOC_QTY,        S1.DATA_CHAR UMSR_NAME,   SUMA.SUM_ALLOC_QTY 
FROM SHIPPING_SCHEDULE SS 
INNER JOIN SALES_ORDER SO 
   ON SS.ORDER_NO = SO.ORDER_NO 
   AND SO.ORDER_STATUS < 90 
INNER JOIN SALES_ORDER_DETAIL SOD 
   ON SS.ORDER_NO = SOD.ORDER_NO 
   AND SS.ORDER_LINE_NO = SOD.ORDER_LINE_NO 
   AND SOD.ORDER_STATUS < 90 
LEFT OUTER JOIN SHIPPING_ALLOCATION SA 
  ON SS.ORDER_NO = SA.ORDER_NO 
  AND SS.ORDER_LINE_NO = SA.ORDER_LINE_NO 
  AND SS.SHIP_SEQ = SA.SHIP_SEQ 
LEFT OUTER JOIN ITEM_MASTER I ON SOD.ITEM_NO = I.ITEM_NO 
LEFT OUTER JOIN WAREHOUSE_MASTER WHS ON SOD.SHIP_WHS  = WHS.WHS_CD 
LEFT OUTER JOIN CUSTOMER_MASTER CM 
  ON SO.SHIP_TO_CD = CM.CUST_CD 
  AND SO.SHIP_TO_SUB_CD = CM.CUST_SUB_CD 
LEFT OUTER JOIN SYSTEM_PARAMETER S1 ON S1.KEY01 = 'ITEM_UMSR' AND S1.KEY02 = I.ITEM_UMSR    
LEFT JOIN (SELECT SUM( ALLOC_QTY) SUM_ALLOC_QTY,ORDER_NO ,ORDER_LINE_NO
             FROM SHIPPING_ALLOCATION 
            GROUP BY ORDER_NO , ORDER_LINE_NO) AS SUMA 
  ON  SS.ORDER_NO = SUMA.ORDER_NO 
  AND SS.ORDER_LINE_NO = SUMA.ORDER_LINE_NO 
WHERE 1 = 1
  AND SS.ORDER_STATUS < 90
  AND SA.ALLOC_QTY <> 0 
  AND (SOD.SHIP_WHS = @SHIP_WHS or @SHIP_WHS = '')
  AND (SS.SCH_SHIP_DATE >= @SCH_SHIP_DATE_BEG or @SCH_SHIP_DATE_BEG = 0)
  AND (SS.SCH_SHIP_DATE <= @SCH_SHIP_DATE_END or @SCH_SHIP_DATE_END = 0) 
ORDER BY SS.SCH_SHIP_DATE, SOD.SHIP_WHS, SOD.ITEM_NO, SS.SHIP_NO

--,CAST(null as image) QRCODE_SHIP_NO 
--,CAST(null as image) QRCODE_ITEM_NO 
--,CAST(null as image) QRCODE_LOCATION 
--,CAST(null as image) QRCODE_LOT_NO 
--,CAST(null as image) QRCODE_MIXED 