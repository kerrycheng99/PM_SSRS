--PurInspProofRpt_受入プルーフリストSQL
DECLARE @BUYER_CD VARCHAR(10),
        @WHS_CD VARCHAR(10),
        @HISTORY_DATE_FROM VARCHAR(10),
        @HISTORY_DATE_TO VARCHAR(10),
        @ITEM_NO_FROM VARCHAR(20),
        @ITEM_NO_TO VARCHAR(20),
        @CHG_USER_ID VARCHAR(10)
SET @BUYER_CD=''
SET @WHS_CD=''
SET @HISTORY_DATE_FROM=''
SET @HISTORY_DATE_TO=''
SET @ITEM_NO_FROM=''
SET @ITEM_NO_TO=''
SET @CHG_USER_ID=''

SELECT 
 T.APPROVE_USER_ID, 
 U.USER_FAMILY_NAME+U.USER_FIRST_NAME APPROVE_USER_NAME, T.TO_WHS_CD+':'+W.WHS_DESC WHS, 
 T.TRANS_DATE,           T.SLIP_NO,        T.TO_JOC_CD, T.ITEM_NO, T.ITEM_DESC, 
 T.NOTE, T.FROM_VC_CD,     V.VENDOR_DESC, T.DELV_NO, P.JOB_ORDER_DATE, 
 P.BUYER_CD,  S1.DATA_CHAR BUYER_NAME,     T.XFER_SCH_DATE, S2.DATA_CHAR UMSR, S3.DATA_CHAR CUR, 
 T.NET_QTY, T.STD_PRC, T.STD_AMT, T.ACT_PRC, 
 CASE T.XFER_STATUS WHEN 90 THEN -1*T.RECV_QTY_PUR_UMSR ELSE T.RECV_QTY_PUR_UMSR END RECV_QTY_PUR_UMSR,
 CASE T.XFER_STATUS WHEN 90 THEN -1*T.ACT_AMT ELSE T.ACT_AMT END ACT_AMT, 
 CASE T.XFER_STATUS WHEN 90 THEN 'Cancel' ELSE 'Insert' END STAT,  
 CONVERT(varchar(100), T.HISTORY_DATE, 111) HISTORY_DATE, CONVERT(varchar(100), T.HISTORY_DATE, 24) HISTORY_TIME 
,ISNULL(S3.DATA_DEC,0) PRC_DEC, ISNULL(S3.DATA_DEC2,0) AMT_DEC  
FROM TRANSFER_TRANS_HISTORY T 
LEFT JOIN PUR_ORDER P ON T.SLIP_NO    =   P.JOB_ORDER_NO 
LEFT JOIN VENDOR_MASTER V ON T.FROM_VC_CD   =   V.VENDOR_CD 
LEFT JOIN USER_MASTER U ON T.APPROVE_USER_ID = U.USER_ID COLLATE Japanese_CI_AS 
LEFT JOIN WAREHOUSE_MASTER W ON    T.TO_WHS_CD      =   W.WHS_CD
LEFT JOIN SYSTEM_PARAMETER S1 ON S1.KEY01     =   'BUYER_CD'
     AND S1.KEY02    =   P.BUYER_CD
LEFT JOIN SYSTEM_PARAMETER S2 ON S2.KEY01     =   'ITEM_UMSR'
     AND S2.KEY02    =   T.PUR_UMSR
LEFT JOIN SYSTEM_PARAMETER S3 ON S3.KEY01     =   'CURRENCY_CD'
     AND S3.KEY02    =   P.PO_CUR
WHERE 1 = 1 
  AND (T.BUYER_CD = @BUYER_CD or @BUYER_CD = '')
  AND (T.TO_WHS_CD = @WHS_CD or @WHS_CD = '')
  AND (T.HISTORY_DATE >= @HISTORY_DATE_FROM or @HISTORY_DATE_FROM = '')
  AND (T.HISTORY_DATE <= @HISTORY_DATE_TO or @HISTORY_DATE_TO = '')
  AND (T.ITEM_NO >= @ITEM_NO_FROM or @ITEM_NO_FROM = '')
  AND (T.ITEM_NO <= @ITEM_NO_TO or @ITEM_NO_TO = '')
  AND (T.CHG_USER_ID = @CHG_USER_ID or @CHG_USER_ID = '')
ORDER BY T.HISTORY_DATE 


