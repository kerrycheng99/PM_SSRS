--PurPODeliveryPrt_納品書発行SQL
DECLARE @VENDOR_CD VARCHAR(10),
        @PO_DUE_DATE INT,
        @PRINT_MODE INT,    --1:納品書発行モード 2:分納品書発行モード 
        @REISSUE_FLAG INT   --0発行の場合 1.再発行の場合
SET @VENDOR_CD=''
SET @PO_DUE_DATE=0
SET @PRINT_MODE=1
SET @REISSUE_FLAG=0

SELECT
V.ZIP_CD,       V.ADDRESS1,      V.ADDRESS2,    V.ADDRESS3,   V.ADDRESS4,
V.VENDOR_DESC,       V.VENDOR_ATTN,      V.TELNO,            V.FAXNO,
P.PO_DUE_DATE,       S1.DATA_CHAR,       S1.DATA_CHAR3,      S1.DATA_CHAR4,
P.BUYER_CD,          S1.DATA_CHAR5,      S1.DATA_CHAR6,      P.PO_NO,
P.PO_LINE_NO,        P.ITEM_NO,          P.ITEM_DESC,        P.PO_QTY,
P.PO_UMSR,           P.VENDOR_NAME,      P.JOC_CD,         P.VENDOR_ITEM_NO, 
P.VENDOR_ITEM_DESC,  S2.DATA_CHAR UMSR_NAME,P.RECV_QTY,      P.REJ_QTY,
P.RECV_LOC,     S3.DATA_CHAR BUYER_NAME, V.VENDOR_CD,
CASE ISNULL(S5.DATA_INT,0) WHEN 0 THEN  S4.DATA_INT ELSE S5.DATA_INT END LANG
FROM PUR_ORDER P
LEFT JOIN SYSTEM_PARAMETER S1 ON S1.KEY01 = 'COMPANY_CD' AND S1.KEY02 = '*'
LEFT JOIN SYSTEM_PARAMETER S2 ON P.PO_UMSR = S2.KEY02 AND S2.KEY01 = 'ITEM_UMSR'
LEFT JOIN SYSTEM_PARAMETER S3 ON S3.KEY01 = 'BUYER_CD' AND S3.KEY02 = P.BUYER_CD
LEFT JOIN VENDOR_MASTER V ON P.VENDOR_CD = V.VENDOR_CD
LEFT JOIN SYSTEM_PARAMETER S4 ON S4.KEY01  = 'PRINT_LANG' AND  S4.KEY02 = '*'
LEFT JOIN SYSTEM_PARAMETER S5 ON S5.KEY01  = 'COUNTRY_CD' AND  S5.KEY02   =   V.COUNTRY_CD
WHERE 1 = 1
  AND P.ORDER_STATUS    >=      25
  AND P.ORDER_STATUS    <       30
  AND P.VENDOR_CD IN ( @VENDOR_CD )
  AND P.PO_DUE_DATE IN ( @PO_DUE_DATE )
  AND ( (@PRINT_MODE = 1  and P.RECV_QTY = 0  --納品書発行モード
                          and (   (@REISSUE_FLAG = 0 and P.DELIVERY_PRINT_FLAG = 0)    --発行の場合,納品書未発行
                               or (@REISSUE_FLAG = 1 and P.DELIVERY_PRINT_FLAG = 1 ) ) --再発行の場合,納品書発行済
        ) or
       (@PRINT_MODE != 1 and P.RECV_QTY > 0   --分納品書発行モード 
                         and (    (@REISSUE_FLAG = 0  and P.DELIVERY_PRINT_FLAG = 0)    --発行の場合,納品書未発行
                               or (@REISSUE_FLAG = 1  and P.DELIVERY_PRINT_FLAG = 1 ) ) --再発行の場合,納品書発行済
        ) )
 ORDER BY P.VENDOR_CD,   P.PO_DUE_DATE,  V.VENDOR_NAME   
